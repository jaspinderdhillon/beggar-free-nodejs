<!DOCTYPE html>
<html lang="en" ng-app="BeggarApp" ng-controller="BeggarController">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beggar Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background-color: #f9fafb;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    
        h2 {
            font-weight: 600;
            color: #374151;
        }
    
        /* Card styling */
        .card {
            border: none;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            background-color: #fff;
        }
    
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }
    
        .card-img-top {
            height: 200px;
            object-fit: cover;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            background-color: #e5e7eb;
        }
    
        .card-body {
            padding: 1rem 1.2rem;
            display: flex;
            flex-direction: column;
        }
    
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.5rem;
        }
    
        .meta {
            font-size: 0.9rem;
            color: #4b5563;
            margin-bottom: 0.35rem;
            line-height: 1.4;
        }
    
        .meta strong {
            color: #111827;
        }
    
        .meta img {
            max-width: 90px;
            max-height: 60px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: #fff;
        }
    
        /* Delete button styling */
        .btn-delete {
            margin-top: auto;
            background-color: #fee2e2;
            color: #b91c1c;
            border: none;
            font-size: 0.85rem;
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            transition: background-color 0.2s ease;
        }
    
        .btn-delete:hover {
            background-color: #fca5a5;
            color: #7f1d1d;
        }
    
        /* Fetch button */
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1.4rem;
            font-weight: 500;
            transition: background 0.2s ease;
        }
    
        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }
    
        /* Message text */
        p.text-danger {
            font-size: 1rem;
            font-weight: 500;
        }
    </style>
    
    <script>
    $(document).ready(function(){
        if(sessionStorage.getItem("loggedInEmail") == null){
            location.href = "index.html";
            return;
        } else {
            $("#activeUser").html(sessionStorage.getItem("loggedInEmail"));
        }
    });

    var app = angular.module("BeggarApp", []);
    app.controller("BeggarController", function($scope, $http){
        $scope.beggars = [];
        $scope.msg = "";
        $scope.email = sessionStorage.getItem("loggedInEmail") || "";

        $scope.doFetchBeggars = function(){
            if(!$scope.email){
                $scope.msg = "No volunteer email found.";
                return;
            }
            let url = "/fetch-beggars?volunteer_email=" + $scope.email;
            $http.get(url).then(function(response){
                $scope.beggars = response.data;
                $scope.msg = ($scope.beggars.length > 0) 
                    ? $scope.beggars.length + " beggar(s) found."
                    : "No beggar profiles found!";
            }, function(){
                $scope.msg = "Error fetching beggars.";
            });
        };

        $scope.doDelete = function(idproofnum){
            if(!confirm("Are you sure you want to delete this beggar profile?")) return;
            $http.post("/delete-beggar", { idproofnum: idproofnum })
            .then(function(){
                $scope.beggars = $scope.beggars.filter(b => b.idproofnum !== idproofnum);
                $scope.msg = "Deleted successfully!";
            }, function(){
                $scope.msg = "Error deleting profile.";
            });
        };

        if($scope.email){
            $scope.doFetchBeggars();
        }
    });
    </script>
</head>
<body>

<!-- Navbar -->


<!-- Main container -->
<div class="container mt-4">
    <h2 class="text-center mb-4">Beggar Manager Dashboard</h2>
    <div class="text-center mb-3">
        <button class="btn btn-success" ng-click="doFetchBeggars()">Fetch All Beggars</button>
    </div>
    <p class="text-center text-danger">{{msg}}</p>

    <div class="row">
        <div class="col-sm-6 col-md-4 col-lg-3 mb-4" ng-repeat="b in beggars">
            <div class="card h-100">
                <img class="card-img-top" ng-src="{{b.photo || 'placeholder.jpg'}}" alt="Photo">
                <div class="card-body">
                    <h5 class="card-title">{{b.name || 'Unknown'}}</h5>
                    <p class="meta"><strong>City:</strong> {{b.city || 'N/A'}}</p>
                    <p class="meta"><strong>Address:</strong> {{b.address || 'N/A'}}</p>
                    <p class="meta"><strong>Contact:</strong> {{b.contact || 'N/A'}}</p>
                    <p class="meta"><strong>Gender:</strong> {{b.gender || 'N/A'}}</p>
                    <p class="meta"><strong>DOB:</strong> {{b.dob | date:'yyyy-MM-dd'}}</p>
                    <p class="meta" ng-if="b.idproof"><strong>ID Proof:</strong> <img ng-src="{{b.idproof}}" alt="ID Proof"></p>
                    <p class="meta"><strong>ID Number:</strong> {{b.idproofnum || 'N/A'}}</p>
                    <p class="meta"><strong>Other Info:</strong> {{b.otherinfo || 'N/A'}}</p>
                    <button class="btn btn-outline-danger btn-sm btn-delete" ng-click="doDelete(b.idproofnum)">Delete</button>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>
