<!DOCTYPE html>
<html lang="en" ng-app="AdminApp" ng-controller="AdminController">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard (AngularJS)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .user-photo {
            width: 48px;
            height: 48px;
            object-fit: cover;
            border-radius: 6px;
        }

        .status-badge {
            font-size: .85rem;
        }

        .table thead th {
            white-space: nowrap;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
    <script>
        angular.module('AdminApp', [])
            .controller('AdminController', function ($scope, $http) {
                $scope.tab = 'volunteers';
                $scope.volunteers = [];
                $scope.clients = [];
                $scope.volunteerMsg = '';
                $scope.clientMsg = '';

                // Load users by type
                $scope.loadUsers = function (type) {
                    if (type === 'volunteer') $scope.volunteerMsg = '';
                    if (type === 'client') $scope.clientMsg = '';

                    $http.get('/admin/users', { params: { type: type } })
                        .then(function (res) {
                            if (type === 'volunteer') $scope.volunteers = res.data || [];
                            if (type === 'client') $scope.clients = res.data || [];
                        })
                        .catch(function (err) {
                            var msg = (err.data && err.data.error) || 'Error fetching users';
                            if (type === 'volunteer') $scope.volunteerMsg = msg;
                            if (type === 'client') $scope.clientMsg = msg;
                        });
                };

                // Toggle status
                $scope.toggleStatus = function (user) {
                    var newStatus = user.status == 1 ? 0 : 1;
                    $http.post('/admin/user-status', { email: user.email, status: newStatus })
                        .then(function (res) {
                            user.status = res.data.status; // update directly in list
                        })
                        .catch(function (err) {
                            alert((err.data && err.data.error) || 'Failed to update status');
                        });
                };

                // Load volunteers on startup
                $scope.loadUsers('volunteer');
            });
    </script>
</head>

<body class="bg-light">
    <div class="container py-4">
        <h2 class="text-center mb-4">Admin Dashboard</h2>

        <!-- Tabs -->
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link" ng-class="{active: tab==='volunteers'}" href=""
                    ng-click="tab='volunteers'">Volunteers</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" ng-class="{active: tab==='clients'}" href="" ng-click="tab='clients'">Clients</a>
            </li>
        </ul>

        <div class="border border-top-0 rounded-bottom p-3 bg-white shadow-sm">
            <!-- Volunteers Table -->
            <div ng-show="tab==='volunteers'">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">All Volunteers</h5>
                    <button class="btn btn-sm btn-outline-primary" ng-click="loadUsers('volunteer')">Refresh</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>Photo</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>City</th>
                                <th>Contact</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="u in volunteers">
                                <td>
                                    <img ng-if="u.photo" ng-src="{{u.photo}}" class="user-photo">
                                    <span ng-if="!u.photo">-</span>
                                </td>
                                <td>{{u.name || '-'}}</td>
                                <td>{{u.email}}</td>
                                <td>{{u.city || '-'}}</td>
                                <td>{{u.contact || '-'}}</td>
                                <td>
                                    <span class="badge"
                                        ng-class="{'bg-success': u.status==1, 'bg-secondary': u.status!=1}">
                                        {{u.status==1 ? 'Active' : 'Blocked'}}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm"
                                        ng-class="u.status==1 ? 'btn-outline-danger' : 'btn-outline-success'"
                                        ng-click="toggleStatus(u)">
                                        {{u.status==1 ? 'Block' : 'Resume'}}
                                    </button>
                                </td>
                            </tr>
                            <tr ng-if="!volunteers.length">
                                <td colspan="7" class="text-center text-muted">No records found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="text-danger small">{{volunteerMsg}}</div>
            </div>

            <!-- Clients Table -->
            <div ng-show="tab==='clients'">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">All Clients</h5>
                    <button class="btn btn-sm btn-outline-primary" ng-click="loadUsers('client')">Refresh</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>Photo</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>City</th>
                                <th>Contact</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="u in clients">
                                <td>
                                    <img ng-if="u.photo" ng-src="{{u.photo}}" class="user-photo">
                                    <span ng-if="!u.photo">-</span>
                                </td>
                                <td>{{u.name || '-'}}</td>
                                <td>{{u.email}}</td>
                                <td>{{u.city || '-'}}</td>
                                <td>{{u.contact || '-'}}</td>
                                <td>
                                    <span class="badge"
                                        ng-class="{'bg-success': u.status==1, 'bg-secondary': u.status!=1}">
                                        {{u.status==1 ? 'Active' : 'Blocked'}}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm"
                                        ng-class="u.status==1 ? 'btn-outline-danger' : 'btn-outline-success'"
                                        ng-click="toggleStatus(u)">
                                        {{u.status==1 ? 'Block' : 'Resume'}}
                                    </button>
                                </td>
                            </tr>
                            <tr ng-if="!clients.length">
                                <td colspan="7" class="text-center text-muted">No records found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="text-danger small">{{clientMsg}}</div>
            </div>
        </div>
    </div>


</body>

</html>